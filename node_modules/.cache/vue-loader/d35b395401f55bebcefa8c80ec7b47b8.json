{"remainingRequest":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/table-extend/dap-ui-table-extend.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/table-extend/dap-ui-table-extend.vue","mtime":1582245542097},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBJbnB1dENvbXBvbmVudE1peGluIGZyb20gIi4uLy4uLy4uL21peGlucy9pbnB1dC1jb21wb25lbnQtbWl4aW4uanMiOwppbXBvcnQgQmFzaWNDb21wb25lbnRNaXhpbiBmcm9tICIuLi8uLi8uLi9taXhpbnMvYmFzaWMtY29tcG9uZW50LW1peGluLmpzIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiRGFwVWlUYWJsZUV4dGVuZCIsCiAgdHlwZTogIkZPUk1fSU5QVVQiLAogIG1peGluczogW0lucHV0Q29tcG9uZW50TWl4aW4sIEJhc2ljQ29tcG9uZW50TWl4aW5dLAogIHByb3BzOiB7CiAgICBjb2x1bW5zOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0YWJsZUJhc2VDb25maWc6IHsKICAgICAgICBzZWxlY3RNb2RlOiAiIiwKICAgICAgICBtYXhIZWlnaHQ6ICIyNDBweCIsCiAgICAgICAgdmlydHVhbExpc3Q6IHRydWUKICAgICAgfSwKICAgICAgdmVydGljYWxUYWJsZUJhc2VDb25maWc6IHsKICAgICAgICBzZWxlY3RNb2RlOiAiIiwKICAgICAgICBtYXhIZWlnaHQ6ICIyNDBweCIsCiAgICAgICAgdmlydHVhbExpc3Q6IHRydWUKICAgICAgfSwKICAgICAgZGlzcGxheVR5cGU6ICJob3Jpem9udGFsIiwKICAgICAgZGlzcGxheVR5cGVMYWJlbHM6IFsKICAgICAgICB7CiAgICAgICAgICBsYWJlbDogIuaoquWQkSjliJfooagpIiwKICAgICAgICAgIHZhbHVlOiAiaG9yaXpvbnRhbCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGxhYmVsOiAi57q15ZCRKOWNleadoeaYjue7hikiLAogICAgICAgICAgdmFsdWU6ICJ2ZXJ0aWNhbCIKICAgICAgICB9CiAgICAgIF0sCiAgICAgIHJlYWRPbmx5OiBmYWxzZQogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBjb2x1bW5zOiB7CiAgICAgIGhhbmRsZXIobmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgICAgaWYgKG5ld1ZhbHVlKSB7CiAgICAgICAgICBjb25zdCBjb2x1bW5zID0gW107CiAgICAgICAgICBuZXdWYWx1ZS5tYXAoaXRlbSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IHsKICAgICAgICAgICAgICBmaWVsZDogaXRlbS5mb3JtQ29udHJvbE5hbWUsCiAgICAgICAgICAgICAgdGl0bGU6IGl0ZW0udGl0bGUsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IGl0ZW0ucmVxdWlyZWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29sdW1ucy5wdXNoKGNvbHVtbik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudGFibGVCYXNlQ29uZmlnLmNvbHVtbnMgPSBjb2x1bW5zOyAvLyDmqKrlkJHooajmoLwKICAgICAgICAgIHRoaXMudmVydGljYWxUYWJsZUJhc2VDb25maWcuY29sdW1ucyA9IFsKICAgICAgICAgICAgeyBmaWVsZDogIl8iLCB0aXRsZTogIiIsIHNsb3ROYW1lOiAiY3VzdG9tQ29sdW1uIiB9CiAgICAgICAgICBdOyAvLyDnurXlkJHooajmoLwKICAgICAgICAgIC8vIHJlYWRvbmx5CiAgICAgICAgICBjb25zdCBmbGFnID0gbmV3VmFsdWUuZXZlcnkoaXRlbSA9PiBpdGVtLnJlYWRPbmx5KTsKICAgICAgICAgIHRoaXMucmVhZE9ubHkgPSBmbGFnOwogICAgICAgICAgaWYgKGZsYWcpIHsKICAgICAgICAgICAgdGhpcy50YWJsZUJhc2VDb25maWcuc2VsZWN0TW9kZSA9ICIiOwogICAgICAgICAgICB0aGlzLnZlcnRpY2FsVGFibGVCYXNlQ29uZmlnLnNlbGVjdE1vZGUgPSAiIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudGFibGVCYXNlQ29uZmlnLnNlbGVjdE1vZGUgPSAibXVsdGlwYXJ0IjsKICAgICAgICAgICAgdGhpcy52ZXJ0aWNhbFRhYmxlQmFzZUNvbmZpZy5zZWxlY3RNb2RlID0gIm11bHRpcGFydCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBpbW1lZGlhdGU6IHRydWUKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHNjcm9sbFRvTGFzdFJvdygpIHsKICAgICAgY29uc3Qgcm93ID0gdGhpcy52YWx1ZVt0aGlzLnZhbHVlLmxlbmd0aCAtIDFdOwogICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZSA9PT0gImhvcml6b250YWwiKSB7CiAgICAgICAgdGhpcy4kcmVmcy5ob3Jpem9udGFsVGFibGUuc2Nyb2xsVG9Sb3cocm93KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyZWZzLnZlcnRpY2FsVGFibGUuc2Nyb2xsVG9Sb3cocm93KTsKICAgICAgfQogICAgfSwKICAgIGdldENoZWNrZWREYXRhKCkgewogICAgICBsZXQgY2hlY2tlZERhdGE7CiAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAiaG9yaXpvbnRhbCIpIHsKICAgICAgICBjaGVja2VkRGF0YSA9IHRoaXMuJHJlZnMuaG9yaXpvbnRhbFRhYmxlLmdldENoZWtjZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjaGVja2VkRGF0YSA9IHRoaXMuJHJlZnMudmVydGljYWxUYWJsZS5nZXRDaGVrY2VkKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNoZWNrZWREYXRhOwogICAgfSwKICAgIG9uQ2xpY2tBZGQoZSkgewogICAgICBjb25zdCBvYmogPSB7fTsKICAgICAgdGhpcy50YWJsZUJhc2VDb25maWcuY29sdW1ucy5tYXAoaXRlbSA9PiB7CiAgICAgICAgb2JqW2l0ZW0uZmllbGRdID0gdW5kZWZpbmVkOwogICAgICB9KTsKICAgICAgdGhpcy52YWx1ZS5wdXNoKG9iaik7CiAgICAgIHRoaXMuc2Nyb2xsVG9MYXN0Um93KCk7CiAgICAgIHRoaXMuJGZvcm1FdmVudEVtaXQoJ2FkZC1yZWNvcmQnLCB7CiAgICAgICAgbW91c2VFdmVudDogZQogICAgICB9KTsKICAgIH0sCiAgICBvbkNsaWNrQ29weShlKSB7CiAgICAgIGNvbnN0IGNoZWNrZWREYXRhID0gdGhpcy5nZXRDaGVja2VkRGF0YSgpOwogICAgICBjb25zdCBhcnIgPSBbXTsKICAgICAgY2hlY2tlZERhdGEubWFwKGl0ZW0gPT4gewogICAgICAgIGNvbnN0IG9iaiA9IHt9OwogICAgICAgIHRoaXMudGFibGVCYXNlQ29uZmlnLmNvbHVtbnMubWFwKGNvbHVtbiA9PiB7CiAgICAgICAgICBvYmpbY29sdW1uLmZpZWxkXSA9IGl0ZW1bY29sdW1uLmZpZWxkXTsKICAgICAgICB9KTsKICAgICAgICBhcnIucHVzaChvYmopOwogICAgICB9KTsKICAgICAgdGhpcy52YWx1ZS5wdXNoKC4uLmFycik7CiAgICAgIHRoaXMuc2Nyb2xsVG9MYXN0Um93KCk7CiAgICAgIHRoaXMuJGZvcm1FdmVudEVtaXQoJ2NvcHktcmVjb3JkJywgewogICAgICAgIG1vdXNlRXZlbnQ6IGUKICAgICAgfSk7CiAgICB9LAogICAgb25DbGlja0RlbGV0ZShlKSB7CiAgICAgIGNvbnN0IGNoZWNrZWREYXRhID0gdGhpcy5nZXRDaGVja2VkRGF0YSgpOwogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2hlY2tlZERhdGEpIHsKICAgICAgICB0aGlzLnZhbHVlLnNwbGljZSh0aGlzLnZhbHVlLmluZGV4T2YoaXRlbSksIDEpOwogICAgICB9CiAgICAgIHRoaXMuJGZvcm1FdmVudEVtaXQoJ2RlbGV0ZS1yZWNvcmQnLCB7CiAgICAgICAgbW91c2VFdmVudDogZSwKICAgICAgICBjaGVja2VkRGF0YTogY2hlY2tlZERhdGEKICAgICAgfSk7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["dap-ui-table-extend.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dap-ui-table-extend.vue","sourceRoot":"packages/components/form/table-extend","sourcesContent":["<!--\n * @Author: your name\n * @Date: 2020-02-20 10:13:07\n * @LastEditTime: 2020-02-20 18:08:03\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /dap-vue-ui/packages/components/form/table-extend/dap-ui-table-extend.vue\n -->\n<template>\n  <div class=\"dap-ui-table-extend\">\n    <div class=\"dap-ui-table-extend-title\">\n      <div class=\"title\">\n        <span :style=\"{'color': labelColor}\">{{ label }}</span>\n      </div>\n      <div class=\"operation\">\n        <span>显示方式：</span>\n        <a-radio-group v-model=\"displayType\">\n          <a-radio\n            v-for=\"(item, index) in displayTypeLabels\"\n            :key=\"index\"\n            :value=\"item.value\"\n          >{{ item.label }}</a-radio>\n        </a-radio-group>\n        <a-button v-if=\"!readOnly\" type=\"primary\" size=\"small\" @click=\"onClickAdd\">新建记录</a-button>\n        <a-button v-if=\"!readOnly\" style=\"margin-left: 1rem;\" type=\"primary\" size=\"small\" @click=\"onClickCopy\">复制新建</a-button>\n        <a-button v-if=\"!readOnly\" style=\"margin-left: 1rem;\" type=\"default\" size=\"small\" @click=\"onClickDelete\">删除</a-button>\n      </div>\n    </div>\n    <dap-ui-table\n      v-if=\"displayType === 'horizontal'\"\n      ref=\"horizontalTable\"\n      :table-data.sync=\"value\"\n      :table-base-config=\"tableBaseConfig\"\n    ></dap-ui-table>\n    <div v-if=\"displayType === 'vertical'\" class=\"vertical-table\">\n      <dap-ui-table\n        ref=\"verticalTable\"\n        :table-data.sync=\"value\"\n        :table-base-config=\"verticalTableBaseConfig\"\n      >\n        <template v-slot:customColumn=\"{ row, rowIndex }\">\n          <div class=\"vertical-row\">\n            <div class=\"column\" v-for=\"(column, index) in tableBaseConfig.columns\" :key=\"index\">\n              <a-tooltip :title=\"column.title\">\n                <span class=\"label\" :class=\"{ required: column.required }\">{{ column.title }}：</span>\n              </a-tooltip>\n              <div class=\"value\">{{ row[column.field] }}</div>\n            </div>\n          </div>\n        </template>\n      </dap-ui-table>\n    </div>\n  </div>\n</template>\n\n<script>\nimport InputComponentMixin from \"../../../mixins/input-component-mixin.js\";\nimport BasicComponentMixin from \"../../../mixins/basic-component-mixin.js\";\n\nexport default {\n  name: \"DapUiTableExtend\",\n  type: \"FORM_INPUT\",\n  mixins: [InputComponentMixin, BasicComponentMixin],\n  props: {\n    columns: {\n      type: Array,\n      default: function() {\n        return [];\n      }\n    }\n  },\n  data() {\n    return {\n      tableBaseConfig: {\n        selectMode: \"\",\n        maxHeight: \"240px\",\n        virtualList: true\n      },\n      verticalTableBaseConfig: {\n        selectMode: \"\",\n        maxHeight: \"240px\",\n        virtualList: true\n      },\n      displayType: \"horizontal\",\n      displayTypeLabels: [\n        {\n          label: \"横向(列表)\",\n          value: \"horizontal\"\n        },\n        {\n          label: \"纵向(单条明细)\",\n          value: \"vertical\"\n        }\n      ],\n      readOnly: false\n    };\n  },\n  watch: {\n    columns: {\n      handler(newValue, oldValue) {\n        if (newValue) {\n          const columns = [];\n          newValue.map(item => {\n            const column = {\n              field: item.formControlName,\n              title: item.title,\n              required: item.required\n            };\n            columns.push(column);\n          });\n          this.tableBaseConfig.columns = columns; // 横向表格\n          this.verticalTableBaseConfig.columns = [\n            { field: \"_\", title: \"\", slotName: \"customColumn\" }\n          ]; // 纵向表格\n          // readonly\n          const flag = newValue.every(item => item.readOnly);\n          this.readOnly = flag;\n          if (flag) {\n            this.tableBaseConfig.selectMode = \"\";\n            this.verticalTableBaseConfig.selectMode = \"\";\n          } else {\n            this.tableBaseConfig.selectMode = \"multipart\";\n            this.verticalTableBaseConfig.selectMode = \"multipart\";\n          }\n        }\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    scrollToLastRow() {\n      const row = this.value[this.value.length - 1];\n      if (this.displayType === \"horizontal\") {\n        this.$refs.horizontalTable.scrollToRow(row);\n      } else {\n        this.$refs.verticalTable.scrollToRow(row);\n      }\n    },\n    getCheckedData() {\n      let checkedData;\n      if (this.displayType === \"horizontal\") {\n        checkedData = this.$refs.horizontalTable.getChekced();\n      } else {\n        checkedData = this.$refs.verticalTable.getChekced();\n      }\n      return checkedData;\n    },\n    onClickAdd(e) {\n      const obj = {};\n      this.tableBaseConfig.columns.map(item => {\n        obj[item.field] = undefined;\n      });\n      this.value.push(obj);\n      this.scrollToLastRow();\n      this.$formEventEmit('add-record', {\n        mouseEvent: e\n      });\n    },\n    onClickCopy(e) {\n      const checkedData = this.getCheckedData();\n      const arr = [];\n      checkedData.map(item => {\n        const obj = {};\n        this.tableBaseConfig.columns.map(column => {\n          obj[column.field] = item[column.field];\n        });\n        arr.push(obj);\n      });\n      this.value.push(...arr);\n      this.scrollToLastRow();\n      this.$formEventEmit('copy-record', {\n        mouseEvent: e\n      });\n    },\n    onClickDelete(e) {\n      const checkedData = this.getCheckedData();\n      for (const item of checkedData) {\n        this.value.splice(this.value.indexOf(item), 1);\n      }\n      this.$formEventEmit('delete-record', {\n        mouseEvent: e,\n        checkedData: checkedData\n      });\n    }\n  }\n};\n</script>\n<style src=\"./index.less\" lang=\"less\"></style>\n"]}]}