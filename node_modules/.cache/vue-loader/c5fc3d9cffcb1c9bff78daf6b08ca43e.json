{"remainingRequest":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-picture/dap-ui-upload-picture.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-picture/dap-ui-upload-picture.vue","mtime":1583478997545},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBCYXNpY0NvbXBvbmVudE1peGluIGZyb20gJy4uLy4uLy4uL21peGlucy9iYXNpYy1jb21wb25lbnQtbWl4aW4uanMnOwppbXBvcnQgQXR0YWNobWVudENvbXBvbmVudE1peGluIGZyb20gIi4uLy4uLy4uL21peGlucy9hdHRhY2htZW50LWNvbXBvbmVudC1taXhpbi5qcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkRhcFVpVXBsb2FkUGljdHVyZSIsCiAgdHlwZTogJ0ZPUk1fQVRUQUNITUVOVCcsCiAgbWl4aW5zOiBbQmFzaWNDb21wb25lbnRNaXhpbiwgQXR0YWNobWVudENvbXBvbmVudE1peGluXSwKICBwcm9wczogewogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGZpbGVMaXN0OiBbXSwgLy8g5paH5Lu25YiX6KGo77yM5b2i5byP5Li6W3t1aWQ6IjEyMyIsbmFtZToiMS5qcGciLHVybDoiaHR0cDovLzEyMzM4OCoqKioqIn1dCiAgICAgIGZpcnN0R2V0VmFsdWU6IHRydWUsIC8vIOesrOS4gOasoeiOt+WPluWIsHZhbHVl5Yik5patIAogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIC8vIGZpbGVDb2RlTGlzdOWAvOaUueWPmCDkuLrnm5HlkKzliKDpmaTmiJDlip/kuovku7blkozov5vlhaXmmI7nu4bku47mjqXlj6MvcHJvY2Vzcy9mb3JtL2dldEF0dGFjaG1lbnRJbmZv5Y+W5Yiw5YC85LqL5Lu2CiAgICBmaWxlQ29kZUxpc3QgOiB7CiAgICAgIGhhbmRsZXIgKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgICAgIGlmIChuZXdWYWx1ZVsndHlwZSddID09PSAnZGVsZXRlJykgewogICAgICAgICAgLy8g5Yig6Zmk5LqL5Lu2CiAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gdGhpcy5maWxlTGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLnVpZCAhPT0gbmV3VmFsdWVbJ2NvZGUnXSk7CiAgICAgICAgICBjb25zdCB2YWx1ZVN0cmluZyA9IHRoaXMuZmlsZUxpc3QubWFwKGF0dHIgPT4gewogICAgICAgICAgICByZXR1cm4gYXR0ci51aWQgOwogICAgICAgICAgfSkudG9TdHJpbmcoKTsKICAgICAgICAgIHRoaXMuJGZvcm1FdmVudEVtaXQoJ2NoYW5nZScsIHZhbHVlU3RyaW5nKTsKICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlWyd0eXBlJ10gPT09ICdnZXRWYWx1ZScpIHsKICAgICAgICAgIC8vIOi/m+WFpeaYjue7huS7ji9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6Plj5bliLDlgLzkuovku7YKICAgICAgICAgIHRoaXMuZmlsZUxpc3QgPSBuZXdWYWx1ZVsnY29kZSddOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gaW1tZWRpYXRlOnRydWUsCiAgICAgIGRlZXA6IHRydWUKICAgIH0sCiAgICAvLyBmaWxlQ29kZUxpc3TlgLzmlLnlj5gKICAgIHZhbHVlOiB7CiAgICAgIGhhbmRsZXIgKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgICAgIC8vIOWmguaenC9wcm9jZXNzL2RvY3VtZW50RGV0YWls6L+U5Zue5pyJ5YC877yM5YiZ6LCD55SoL3Byb2Nlc3MvZm9ybS9nZXRBdHRhY2htZW50SW5mb+aOpeWPo+iOt+WPluWujOaVtOmZhOS7tuS/oeaBrwogICAgICAgIGlmICh0aGlzLmRvY3VtZW50SWQgJiYgdGhpcy5maXJzdEdldFZhbHVlICYmIG5ld1ZhbHVlKSB7CiAgICAgICAgICB0aGlzLmZpcnN0R2V0VmFsdWUgPSBmYWxzZTsKICAgICAgICAgIC8vIOWPkeWwhOS6i+S7tu+8jOiwg+eUqC9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6MKICAgICAgICAgIHRoaXMuJGZvcm1FdmVudEVtaXQoJ2dldEF0dGFjaG1lbnQnLCBuZXdWYWx1ZSk7CiAgICAgICAgfQogICAgICB9LAogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8gY2hhbmdl5pa55rOVIOS4iuS8oOS4reOAgeWujOaIkOOAgeWksei0pemDveS8muiwg+eUqOi/meS4quWHveaVsAogICAgbG9hZFN1Y2Nlc3MoZXZlbnQpIHsKICAgICAgdGhpcy5maWxlTGlzdD1ldmVudC5maWxlTGlzdDsKICAgICAgY29uc3QgcmVzID0gZXZlbnQuZmlsZS5yZXNwb25zZTsKICAgICAgLy8g5aaC5p6c5pyJcmVzcG9uc2XvvIzliJnkuIrkvKDlrozmiJAKICAgICAgaWYgKHJlcykgewogICAgICAgIC8vIOa3u+WKoOaTjeS9nAogICAgICAgIGNvbnN0IGJ0dCA9IHt9OwogICAgICAgIGJ0dC51aWQgPSByZXMuZGF0YS5hdHRhY2htZW50Q29kZSA7CiAgICAgICAgLy8gYnR0Lm5hbWUgPSByZXMuZGF0YS5hdHRhY2htZW50TmFtZS5zbGljZShyZXMuZGF0YS5hdHRhY2htZW50Q29kZS5sZW5ndGgpOwogICAgICAgIGJ0dC5uYW1lID0gcmVzLmRhdGEuYXR0YWNobWVudE5hbWU7CiAgICAgICAgYnR0LnVybCA9IHJlcy5kYXRhLmF0dGFjaG1lbnRVcmwgOwogICAgICAgIHRoaXMuZmlsZUxpc3Quc3BsaWNlKHRoaXMuZmlsZUxpc3QubGVuZ3RoIC0gMSwgMSkgOwogICAgICAgIHRoaXMuZmlsZUxpc3QucHVzaChidHQpOwogICAgICAgIHRoaXMuZmlyc3RHZXRWYWx1ZSA9IGZhbHNlOwogICAgICAgIGNvbnN0IHZhbHVlU3RyaW5nID0gdGhpcy5maWxlTGlzdC5tYXAoYXR0ciA9PiB7CiAgICAgICAgICByZXR1cm4gYXR0ci51aWQgOwogICAgICAgIH0pLnRvU3RyaW5nKCk7CiAgICAgICAgdGhpcy4kZm9ybUV2ZW50RW1pdCgnY2hhbmdlJywgdmFsdWVTdHJpbmcpOwogICAgICB9CiAgICB9LAogICAgCiAgfSwKfQo="},{"version":3,"sources":["dap-ui-upload-picture.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"dap-ui-upload-picture.vue","sourceRoot":"packages/components/form/upload-picture","sourcesContent":["<!--\n * @Author: lizhihang\n * @Date: 2020-02-06 10:37:47\n * @LastEditors: lizhihang\n * @LastEditTime: 2020-02-17 08:47:50\n * @Description: file content description\n -->\n<template>\n  <div class=\"dap-ui-upload-picture dap-ui-form-item\">\n    <a-upload\n      listType=\"picture\"\n      :fileList=\"fileList\"\n      :customRequest=\"customRequest\"\n      @change=\"loadSuccess($event)\"\n      :remove=\"remove\"\n    >\n      <a-button type=\"primary\"> <a-icon type=\"picture\" /> {{btnTitle}} </a-button>\n    </a-upload>\n  </div>\n</template>\n<script>\nimport BasicComponentMixin from '../../../mixins/basic-component-mixin.js';\nimport AttachmentComponentMixin from \"../../../mixins/attachment-component-mixin.js\";\n\nexport default {\n  name: \"DapUiUploadPicture\",\n  type: 'FORM_ATTACHMENT',\n  mixins: [BasicComponentMixin, AttachmentComponentMixin],\n  props: {\n  },\n  data() {\n    return {\n      fileList: [], // 文件列表，形式为[{uid:\"123\",name:\"1.jpg\",url:\"http://123388*****\"}]\n      firstGetValue: true, // 第一次获取到value判断 \n    }\n  },\n  watch: {\n    // fileCodeList值改变 为监听删除成功事件和进入明细从接口/process/form/getAttachmentInfo取到值事件\n    fileCodeList : {\n      handler (newValue, oldValue) {\n        if (newValue['type'] === 'delete') {\n          // 删除事件\n          this.fileList = this.fileList.filter(item => item.uid !== newValue['code']);\n          const valueString = this.fileList.map(attr => {\n            return attr.uid ;\n          }).toString();\n          this.$formEventEmit('change', valueString);\n        } else if (newValue['type'] === 'getValue') {\n          // 进入明细从/process/form/getAttachmentInfo接口取到值事件\n          this.fileList = newValue['code'];\n        }\n      },\n      // immediate:true,\n      deep: true\n    },\n    // fileCodeList值改变\n    value: {\n      handler (newValue, oldValue) {\n        // 如果/process/documentDetail返回有值，则调用/process/form/getAttachmentInfo接口获取完整附件信息\n        if (this.documentId && this.firstGetValue && newValue) {\n          this.firstGetValue = false;\n          // 发射事件，调用/process/form/getAttachmentInfo接口\n          this.$formEventEmit('getAttachment', newValue);\n        }\n      },\n    }\n  },\n  methods: {\n    // change方法 上传中、完成、失败都会调用这个函数\n    loadSuccess(event) {\n      this.fileList=event.fileList;\n      const res = event.file.response;\n      // 如果有response，则上传完成\n      if (res) {\n        // 添加操作\n        const btt = {};\n        btt.uid = res.data.attachmentCode ;\n        // btt.name = res.data.attachmentName.slice(res.data.attachmentCode.length);\n        btt.name = res.data.attachmentName;\n        btt.url = res.data.attachmentUrl ;\n        this.fileList.splice(this.fileList.length - 1, 1) ;\n        this.fileList.push(btt);\n        this.firstGetValue = false;\n        const valueString = this.fileList.map(attr => {\n          return attr.uid ;\n        }).toString();\n        this.$formEventEmit('change', valueString);\n      }\n    },\n    \n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style src=\"./index.less\" lang=\"less\">\n</style>\n"]}]}