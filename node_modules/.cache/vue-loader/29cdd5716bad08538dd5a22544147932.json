{"remainingRequest":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-attachment/dap-ui-upload-attachment.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-attachment/dap-ui-upload-attachment.vue","mtime":1583478997545},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBCYXNpY0NvbXBvbmVudE1peGluIGZyb20gJy4uLy4uLy4uL21peGlucy9iYXNpYy1jb21wb25lbnQtbWl4aW4uanMnOwppbXBvcnQgQXR0YWNobWVudENvbXBvbmVudE1peGluIGZyb20gIi4uLy4uLy4uL21peGlucy9hdHRhY2htZW50LWNvbXBvbmVudC1taXhpbi5qcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkRhcFVpVXBsb2FkQXR0YWNobWVudCIsCiAgdHlwZTogJ0ZPUk1fQVRUQUNITUVOVCcsCiAgbWl4aW5zOiBbQmFzaWNDb21wb25lbnRNaXhpbiwgQXR0YWNobWVudENvbXBvbmVudE1peGluXSwKICBwcm9wczogewogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGZpcnN0R2V0VmFsdWU6IHRydWUsIC8vIOesrOS4gOasoeiOt+WPluWIsHZhbHVl5Yik5patIAogICAgICB1cGxvYWRQcm9jZXNzOiAwLAogICAgICBzaG93VXBsb2FkUHJvY2VzczogZmFsc2UsCiAgICAgIHRhYmxlQmFzZUNvbmZpZzogewogICAgICAgIHNpemU6ICJzbWFsbCIsCiAgICAgICAgdmlydHVhbExpc3Q6IGZhbHNlLAogICAgICAgIGNvbHVtbnM6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgZmllbGQ6ICJmaWxlTmFtZSIsCiAgICAgICAgICAgIHRpdGxlOiAi5paH5Lu25ZCNIiwKICAgICAgICAgICAgYWxpZ246ICJsZWZ0IgogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgZmllbGQ6ICJjcmVhdGVOYW1lIiwKICAgICAgICAgICAgdGl0bGU6ICLkuIrkvKDkuroiLAogICAgICAgICAgICBhbGlnbjogImNlbnRlciIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGZpZWxkOiAidXBsb2FkVGltZSIsCiAgICAgICAgICAgIHRpdGxlOiAi5LiK5Lyg5pe26Ze0IiwKICAgICAgICAgICAgYWxpZ246ICJjZW50ZXIiCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICB0aXRsZTogIuaTjeS9nCIsCiAgICAgICAgICAgIHNsb3ROYW1lOiAib3BlcmF0ZSIsCiAgICAgICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICAgICAgd2lkdGg6ICI4MHB4IgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfSwKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICB2YWx1ZTogewogICAgICBoYW5kbGVyIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgICAvLyDlpoLmnpwvcHJvY2Vzcy9kb2N1bWVudERldGFpbOi/lOWbnuacieWAvO+8jOWImeiwg+eUqC9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6Pojrflj5blrozmlbTpmYTku7bkv6Hmga8KICAgICAgICBpZiAodGhpcy5kb2N1bWVudElkICYmICB0aGlzLmZpcnN0R2V0VmFsdWUgJiYgbmV3VmFsdWUpIHsKICAgICAgICAgIHRoaXMuZmlyc3RHZXRWYWx1ZSA9IGZhbHNlOwogICAgICAgICAgLy8g5Y+R5bCE5LqL5Lu277yM6LCD55SoL3Byb2Nlc3MvZm9ybS9nZXRBdHRhY2htZW50SW5mb+aOpeWPowogICAgICAgICAgdGhpcy4kZm9ybUV2ZW50RW1pdCgnZ2V0QXR0YWNobWVudCcsIG5ld1ZhbHVlKTsKICAgICAgICB9CiAgICAgIH0sCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBpc1Nob3coKSB7CiAgICAgIGlmICh0aGlzLmRvY3VtZW50SWQgJiYgdGhpcy5lZGl0T25OZXcpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0sCiAgICAvLyBjaGFuZ2Xmlrnms5Ug5LiK5Lyg5Lit44CB5a6M5oiQ44CB5aSx6LSl6YO95Lya6LCD55So6L+Z5Liq5Ye95pWwCiAgICBsb2FkU3VjY2VzcyhldmVudCkgewogICAgICBpZiAoZXZlbnQuZmlsZS5wZXJjZW50ID4gMCkgewogICAgICAgIHRoaXMudXBsb2FkUHJvY2VzcyA9IE1hdGguZmxvb3IoZXZlbnQuZmlsZS5wZXJjZW50IC0gMSk7CiAgICAgICAgdGhpcy5zaG93VXBsb2FkUHJvY2VzcyA9IHRydWU7CiAgICAgIH0KICAgICAgY29uc3QgcmVzID0gZXZlbnQuZmlsZS5yZXNwb25zZTsKICAgICAgLy8g5aaC5p6c5pyJcmVzcG9uc2XvvIzliJnkuIrkvKDlrozmiJAKICAgICAgaWYgKHJlcykgewogICAgICAgIHRoaXMudXBsb2FkUHJvY2VzcyA9IDEwMDsKICAgICAgICB0aGlzLnNob3dVcGxvYWRQcm9jZXNzID0gZmFsc2U7CiAgICAgICAgdGhpcy5maXJzdEdldFZhbHVlID0gZmFsc2U7CiAgICAgICAgY29uc3QgdmFsdWVTdHJpbmcgPSB0aGlzLnRhYmxlRGF0YS5tYXAoYXR0ciA9PiB7CiAgICAgICAgICByZXR1cm4gYXR0ci5maWxlQ29kZSA7CiAgICAgICAgfSkudG9TdHJpbmcoKTsKICAgICAgICB0aGlzLiRmb3JtRXZlbnRFbWl0KCdjaGFuZ2UnLCB2YWx1ZVN0cmluZyk7CiAgICAgIH0KICAgIH0sCiAgICBzdG9wQnViYmxlKGUpIHsKICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0sCiAgICBhdHRhY2htZW50RG93bmxvYWQocm93KSB7CiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykgOwogICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHJvdy5maWxlU3JjKSA7CiAgICAgIGNvbnN0IG5ld0ZpbGVOYW1lID0gcm93LmZpbGVOYW1lLnNsaWNlKDAsIHJvdy5maWxlTmFtZS5pbmRleE9mKCcuJykpIDsKICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgbmV3RmlsZU5hbWUpIDsKICAgICAgbGluay5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbicgOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspIDsKICAgICAgbGluay5jbGljaygpIDsKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKSA7CiAgICB9LAogICAgdXBsb2FkRGVsZXRlKHJvdywgaW5kZXgpIHsKICAgICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIHJvdyk7CiAgICAgIGRhdGEuaW5kZXggPSBpbmRleDsKICAgICAgdGhpcy4kZm9ybUV2ZW50RW1pdCgnZGVsZXRlJywgZGF0YSk7CiAgICB9CgogIH0sCn0K"},{"version":3,"sources":["dap-ui-upload-attachment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"dap-ui-upload-attachment.vue","sourceRoot":"packages/components/form/upload-attachment","sourcesContent":["<!--\n * @Author: lizhihang\n * @Date: 2020-02-06 10:37:47\n * @LastEditors: lizhihang\n * @LastEditTime: 2020-02-17 08:47:50\n * @Description: file content description\n -->\n<template>\n  <div class=\"dap-ui-upload-attachment dap-ui-form-item\">\n    <div class=\"attachment-title\">\n      <span class=\"title\"> {{label}} </span>\n      <a-upload\n        :customRequest=\"customRequest\"\n        @change=\"loadSuccess($event)\"\n        :showUploadList=\"false\"\n        :beforeUpload=\"beforeUpload\"\n        v-if=\"isShow()\"\n      >\n        <span class=\"max-upload-size\" @click=\"stopBubble($event)\">单个文件大小不超过{{uploadSize}}M</span>\n        <a-button type=\"primary\" :loading=\"showUploadProcess\"> <a-icon type=\"file\" /> \n          <span v-if=\"!showUploadProcess\">{{ btnTitle}}</span>\n          <span v-if=\"showUploadProcess\">{{ uploadProcess }}%</span> </a-button>\n      </a-upload>\n    </div>\n    \n    <dap-ui-table\n      :table-base-config=\"tableBaseConfig\"\n      :table-data.sync=\"tableData\">\n      <template v-slot:operate=\"{ row, rowIndex }\">\n        <div class=\"operator-column\">\n          <a-icon\n            type=\"download\"\n            style=\"color: #1890ff;\"\n            @click=\"attachmentDownload(row)\"\n          />\n          <a-icon\n            type=\"close-square\"\n            style=\"color: red; margin-left: 5px\"\n            @click=\"uploadDelete(row, rowIndex)\"\n            v-if=\"isShow()\"\n          />\n        </div>\n      </template>\n    </dap-ui-table>\n  </div>\n</template>\n<script>\nimport BasicComponentMixin from '../../../mixins/basic-component-mixin.js';\nimport AttachmentComponentMixin from \"../../../mixins/attachment-component-mixin.js\";\n\nexport default {\n  name: \"DapUiUploadAttachment\",\n  type: 'FORM_ATTACHMENT',\n  mixins: [BasicComponentMixin, AttachmentComponentMixin],\n  props: {\n  },\n  data() {\n    return {\n      firstGetValue: true, // 第一次获取到value判断 \n      uploadProcess: 0,\n      showUploadProcess: false,\n      tableBaseConfig: {\n        size: \"small\",\n        virtualList: false,\n        columns: [\n          {\n            field: \"fileName\",\n            title: \"文件名\",\n            align: \"left\"\n          },\n          {\n            field: \"createName\",\n            title: \"上传人\",\n            align: \"center\"\n          },\n          {\n            field: \"uploadTime\",\n            title: \"上传时间\",\n            align: \"center\"\n          },\n          {\n            title: \"操作\",\n            slotName: \"operate\",\n            align: \"center\",\n            width: \"80px\"\n          }\n        ]\n      },\n    }\n  },\n  watch: {\n    value: {\n      handler (newValue, oldValue) {\n        // 如果/process/documentDetail返回有值，则调用/process/form/getAttachmentInfo接口获取完整附件信息\n        if (this.documentId &&  this.firstGetValue && newValue) {\n          this.firstGetValue = false;\n          // 发射事件，调用/process/form/getAttachmentInfo接口\n          this.$formEventEmit('getAttachment', newValue);\n        }\n      },\n    }\n  },\n  methods: {\n    isShow() {\n      if (this.documentId && this.editOnNew) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n    // change方法 上传中、完成、失败都会调用这个函数\n    loadSuccess(event) {\n      if (event.file.percent > 0) {\n        this.uploadProcess = Math.floor(event.file.percent - 1);\n        this.showUploadProcess = true;\n      }\n      const res = event.file.response;\n      // 如果有response，则上传完成\n      if (res) {\n        this.uploadProcess = 100;\n        this.showUploadProcess = false;\n        this.firstGetValue = false;\n        const valueString = this.tableData.map(attr => {\n          return attr.fileCode ;\n        }).toString();\n        this.$formEventEmit('change', valueString);\n      }\n    },\n    stopBubble(e) {\n      e.stopPropagation();\n    },\n    attachmentDownload(row) {\n      const link = document.createElement('a') ;\n      link.setAttribute('href', row.fileSrc) ;\n      const newFileName = row.fileName.slice(0, row.fileName.indexOf('.')) ;\n      link.setAttribute('download', newFileName) ;\n      link.style.visibility = 'hidden' ;\n      document.body.appendChild(link) ;\n      link.click() ;\n      document.body.removeChild(link) ;\n    },\n    uploadDelete(row, index) {\n      const data = Object.assign({}, row);\n      data.index = index;\n      this.$formEventEmit('delete', data);\n    }\n\n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style src=\"./index.less\" lang=\"less\">\n</style>\n"]}]}