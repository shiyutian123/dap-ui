{"remainingRequest":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-attachment/dap-ui-upload-attachment.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-attachment/dap-ui-upload-attachment.vue","mtime":1583478997545},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IEJhc2ljQ29tcG9uZW50TWl4aW4gZnJvbSAnLi4vLi4vLi4vbWl4aW5zL2Jhc2ljLWNvbXBvbmVudC1taXhpbi5qcyc7CmltcG9ydCBBdHRhY2htZW50Q29tcG9uZW50TWl4aW4gZnJvbSAiLi4vLi4vLi4vbWl4aW5zL2F0dGFjaG1lbnQtY29tcG9uZW50LW1peGluLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJEYXBVaVVwbG9hZEF0dGFjaG1lbnQiLAogIHR5cGU6ICdGT1JNX0FUVEFDSE1FTlQnLAogIG1peGluczogW0Jhc2ljQ29tcG9uZW50TWl4aW4sIEF0dGFjaG1lbnRDb21wb25lbnRNaXhpbl0sCiAgcHJvcHM6IHt9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBmaXJzdEdldFZhbHVlOiB0cnVlLAogICAgICAvLyDnrKzkuIDmrKHojrflj5bliLB2YWx1ZeWIpOaWrSAKICAgICAgdXBsb2FkUHJvY2VzczogMCwKICAgICAgc2hvd1VwbG9hZFByb2Nlc3M6IGZhbHNlLAogICAgICB0YWJsZUJhc2VDb25maWc6IHsKICAgICAgICBzaXplOiAic21hbGwiLAogICAgICAgIHZpcnR1YWxMaXN0OiBmYWxzZSwKICAgICAgICBjb2x1bW5zOiBbewogICAgICAgICAgZmllbGQ6ICJmaWxlTmFtZSIsCiAgICAgICAgICB0aXRsZTogIuaWh+S7tuWQjSIsCiAgICAgICAgICBhbGlnbjogImxlZnQiCiAgICAgICAgfSwgewogICAgICAgICAgZmllbGQ6ICJjcmVhdGVOYW1lIiwKICAgICAgICAgIHRpdGxlOiAi5LiK5Lyg5Lq6IiwKICAgICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICAgIH0sIHsKICAgICAgICAgIGZpZWxkOiAidXBsb2FkVGltZSIsCiAgICAgICAgICB0aXRsZTogIuS4iuS8oOaXtumXtCIsCiAgICAgICAgICBhbGlnbjogImNlbnRlciIKICAgICAgICB9LCB7CiAgICAgICAgICB0aXRsZTogIuaTjeS9nCIsCiAgICAgICAgICBzbG90TmFtZTogIm9wZXJhdGUiLAogICAgICAgICAgYWxpZ246ICJjZW50ZXIiLAogICAgICAgICAgd2lkdGg6ICI4MHB4IgogICAgICAgIH1dCiAgICAgIH0KICAgIH07CiAgfSwKICB3YXRjaDogewogICAgdmFsdWU6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgICAvLyDlpoLmnpwvcHJvY2Vzcy9kb2N1bWVudERldGFpbOi/lOWbnuacieWAvO+8jOWImeiwg+eUqC9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6Pojrflj5blrozmlbTpmYTku7bkv6Hmga8KICAgICAgICBpZiAodGhpcy5kb2N1bWVudElkICYmIHRoaXMuZmlyc3RHZXRWYWx1ZSAmJiBuZXdWYWx1ZSkgewogICAgICAgICAgdGhpcy5maXJzdEdldFZhbHVlID0gZmFsc2U7IC8vIOWPkeWwhOS6i+S7tu+8jOiwg+eUqC9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6MKCiAgICAgICAgICB0aGlzLiRmb3JtRXZlbnRFbWl0KCdnZXRBdHRhY2htZW50JywgbmV3VmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgaXNTaG93OiBmdW5jdGlvbiBpc1Nob3coKSB7CiAgICAgIGlmICh0aGlzLmRvY3VtZW50SWQgJiYgdGhpcy5lZGl0T25OZXcpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0sCiAgICAvLyBjaGFuZ2Xmlrnms5Ug5LiK5Lyg5Lit44CB5a6M5oiQ44CB5aSx6LSl6YO95Lya6LCD55So6L+Z5Liq5Ye95pWwCiAgICBsb2FkU3VjY2VzczogZnVuY3Rpb24gbG9hZFN1Y2Nlc3MoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LmZpbGUucGVyY2VudCA+IDApIHsKICAgICAgICB0aGlzLnVwbG9hZFByb2Nlc3MgPSBNYXRoLmZsb29yKGV2ZW50LmZpbGUucGVyY2VudCAtIDEpOwogICAgICAgIHRoaXMuc2hvd1VwbG9hZFByb2Nlc3MgPSB0cnVlOwogICAgICB9CgogICAgICB2YXIgcmVzID0gZXZlbnQuZmlsZS5yZXNwb25zZTsgLy8g5aaC5p6c5pyJcmVzcG9uc2XvvIzliJnkuIrkvKDlrozmiJAKCiAgICAgIGlmIChyZXMpIHsKICAgICAgICB0aGlzLnVwbG9hZFByb2Nlc3MgPSAxMDA7CiAgICAgICAgdGhpcy5zaG93VXBsb2FkUHJvY2VzcyA9IGZhbHNlOwogICAgICAgIHRoaXMuZmlyc3RHZXRWYWx1ZSA9IGZhbHNlOwogICAgICAgIHZhciB2YWx1ZVN0cmluZyA9IHRoaXMudGFibGVEYXRhLm1hcChmdW5jdGlvbiAoYXR0cikgewogICAgICAgICAgcmV0dXJuIGF0dHIuZmlsZUNvZGU7CiAgICAgICAgfSkudG9TdHJpbmcoKTsKICAgICAgICB0aGlzLiRmb3JtRXZlbnRFbWl0KCdjaGFuZ2UnLCB2YWx1ZVN0cmluZyk7CiAgICAgIH0KICAgIH0sCiAgICBzdG9wQnViYmxlOiBmdW5jdGlvbiBzdG9wQnViYmxlKGUpIHsKICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0sCiAgICBhdHRhY2htZW50RG93bmxvYWQ6IGZ1bmN0aW9uIGF0dGFjaG1lbnREb3dubG9hZChyb3cpIHsKICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgcm93LmZpbGVTcmMpOwogICAgICB2YXIgbmV3RmlsZU5hbWUgPSByb3cuZmlsZU5hbWUuc2xpY2UoMCwgcm93LmZpbGVOYW1lLmluZGV4T2YoJy4nKSk7CiAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIG5ld0ZpbGVOYW1lKTsKICAgICAgbGluay5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTsKICAgIH0sCiAgICB1cGxvYWREZWxldGU6IGZ1bmN0aW9uIHVwbG9hZERlbGV0ZShyb3csIGluZGV4KSB7CiAgICAgIHZhciBkYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgcm93KTsKICAgICAgZGF0YS5pbmRleCA9IGluZGV4OwogICAgICB0aGlzLiRmb3JtRXZlbnRFbWl0KCdkZWxldGUnLCBkYXRhKTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["dap-ui-upload-attachment.vue"],"names":[],"mappings":"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","sourcesContent":["<!--\n * @Author: lizhihang\n * @Date: 2020-02-06 10:37:47\n * @LastEditors: lizhihang\n * @LastEditTime: 2020-02-17 08:47:50\n * @Description: file content description\n -->\n<template>\n  <div class=\"dap-ui-upload-attachment dap-ui-form-item\">\n    <div class=\"attachment-title\">\n      <span class=\"title\"> {{label}} </span>\n      <a-upload\n        :customRequest=\"customRequest\"\n        @change=\"loadSuccess($event)\"\n        :showUploadList=\"false\"\n        :beforeUpload=\"beforeUpload\"\n        v-if=\"isShow()\"\n      >\n        <span class=\"max-upload-size\" @click=\"stopBubble($event)\">单个文件大小不超过{{uploadSize}}M</span>\n        <a-button type=\"primary\" :loading=\"showUploadProcess\"> <a-icon type=\"file\" /> \n          <span v-if=\"!showUploadProcess\">{{ btnTitle}}</span>\n          <span v-if=\"showUploadProcess\">{{ uploadProcess }}%</span> </a-button>\n      </a-upload>\n    </div>\n    \n    <dap-ui-table\n      :table-base-config=\"tableBaseConfig\"\n      :table-data.sync=\"tableData\">\n      <template v-slot:operate=\"{ row, rowIndex }\">\n        <div class=\"operator-column\">\n          <a-icon\n            type=\"download\"\n            style=\"color: #1890ff;\"\n            @click=\"attachmentDownload(row)\"\n          />\n          <a-icon\n            type=\"close-square\"\n            style=\"color: red; margin-left: 5px\"\n            @click=\"uploadDelete(row, rowIndex)\"\n            v-if=\"isShow()\"\n          />\n        </div>\n      </template>\n    </dap-ui-table>\n  </div>\n</template>\n<script>\nimport BasicComponentMixin from '../../../mixins/basic-component-mixin.js';\nimport AttachmentComponentMixin from \"../../../mixins/attachment-component-mixin.js\";\n\nexport default {\n  name: \"DapUiUploadAttachment\",\n  type: 'FORM_ATTACHMENT',\n  mixins: [BasicComponentMixin, AttachmentComponentMixin],\n  props: {\n  },\n  data() {\n    return {\n      firstGetValue: true, // 第一次获取到value判断 \n      uploadProcess: 0,\n      showUploadProcess: false,\n      tableBaseConfig: {\n        size: \"small\",\n        virtualList: false,\n        columns: [\n          {\n            field: \"fileName\",\n            title: \"文件名\",\n            align: \"left\"\n          },\n          {\n            field: \"createName\",\n            title: \"上传人\",\n            align: \"center\"\n          },\n          {\n            field: \"uploadTime\",\n            title: \"上传时间\",\n            align: \"center\"\n          },\n          {\n            title: \"操作\",\n            slotName: \"operate\",\n            align: \"center\",\n            width: \"80px\"\n          }\n        ]\n      },\n    }\n  },\n  watch: {\n    value: {\n      handler (newValue, oldValue) {\n        // 如果/process/documentDetail返回有值，则调用/process/form/getAttachmentInfo接口获取完整附件信息\n        if (this.documentId &&  this.firstGetValue && newValue) {\n          this.firstGetValue = false;\n          // 发射事件，调用/process/form/getAttachmentInfo接口\n          this.$formEventEmit('getAttachment', newValue);\n        }\n      },\n    }\n  },\n  methods: {\n    isShow() {\n      if (this.documentId && this.editOnNew) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n    // change方法 上传中、完成、失败都会调用这个函数\n    loadSuccess(event) {\n      if (event.file.percent > 0) {\n        this.uploadProcess = Math.floor(event.file.percent - 1);\n        this.showUploadProcess = true;\n      }\n      const res = event.file.response;\n      // 如果有response，则上传完成\n      if (res) {\n        this.uploadProcess = 100;\n        this.showUploadProcess = false;\n        this.firstGetValue = false;\n        const valueString = this.tableData.map(attr => {\n          return attr.fileCode ;\n        }).toString();\n        this.$formEventEmit('change', valueString);\n      }\n    },\n    stopBubble(e) {\n      e.stopPropagation();\n    },\n    attachmentDownload(row) {\n      const link = document.createElement('a') ;\n      link.setAttribute('href', row.fileSrc) ;\n      const newFileName = row.fileName.slice(0, row.fileName.indexOf('.')) ;\n      link.setAttribute('download', newFileName) ;\n      link.style.visibility = 'hidden' ;\n      document.body.appendChild(link) ;\n      link.click() ;\n      document.body.removeChild(link) ;\n    },\n    uploadDelete(row, index) {\n      const data = Object.assign({}, row);\n      data.index = index;\n      this.$formEventEmit('delete', data);\n    }\n\n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style src=\"./index.less\" lang=\"less\">\n</style>\n"],"sourceRoot":"packages/components/form/upload-attachment"}]}