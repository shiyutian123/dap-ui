{"remainingRequest":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-picture/dap-ui-upload-picture.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/packages/components/form/upload-picture/dap-ui-upload-picture.vue","mtime":1583478997545},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/coder/project/04_dap/lerna-dap/packages/dap-vue-ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IEJhc2ljQ29tcG9uZW50TWl4aW4gZnJvbSAnLi4vLi4vLi4vbWl4aW5zL2Jhc2ljLWNvbXBvbmVudC1taXhpbi5qcyc7CmltcG9ydCBBdHRhY2htZW50Q29tcG9uZW50TWl4aW4gZnJvbSAiLi4vLi4vLi4vbWl4aW5zL2F0dGFjaG1lbnQtY29tcG9uZW50LW1peGluLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJEYXBVaVVwbG9hZFBpY3R1cmUiLAogIHR5cGU6ICdGT1JNX0FUVEFDSE1FTlQnLAogIG1peGluczogW0Jhc2ljQ29tcG9uZW50TWl4aW4sIEF0dGFjaG1lbnRDb21wb25lbnRNaXhpbl0sCiAgcHJvcHM6IHt9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBmaWxlTGlzdDogW10sCiAgICAgIC8vIOaWh+S7tuWIl+ihqO+8jOW9ouW8j+S4ult7dWlkOiIxMjMiLG5hbWU6IjEuanBnIix1cmw6Imh0dHA6Ly8xMjMzODgqKioqKiJ9XQogICAgICBmaXJzdEdldFZhbHVlOiB0cnVlIC8vIOesrOS4gOasoeiOt+WPluWIsHZhbHVl5Yik5patIAoKICAgIH07CiAgfSwKICB3YXRjaDogewogICAgLy8gZmlsZUNvZGVMaXN05YC85pS55Y+YIOS4uuebkeWQrOWIoOmZpOaIkOWKn+S6i+S7tuWSjOi/m+WFpeaYjue7huS7juaOpeWPoy9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/lj5bliLDlgLzkuovku7YKICAgIGZpbGVDb2RlTGlzdDogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgICAgIGlmIChuZXdWYWx1ZVsndHlwZSddID09PSAnZGVsZXRlJykgewogICAgICAgICAgLy8g5Yig6Zmk5LqL5Lu2CiAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gdGhpcy5maWxlTGlzdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0udWlkICE9PSBuZXdWYWx1ZVsnY29kZSddOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgdmFsdWVTdHJpbmcgPSB0aGlzLmZpbGVMaXN0Lm1hcChmdW5jdGlvbiAoYXR0cikgewogICAgICAgICAgICByZXR1cm4gYXR0ci51aWQ7CiAgICAgICAgICB9KS50b1N0cmluZygpOwogICAgICAgICAgdGhpcy4kZm9ybUV2ZW50RW1pdCgnY2hhbmdlJywgdmFsdWVTdHJpbmcpOwogICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWVbJ3R5cGUnXSA9PT0gJ2dldFZhbHVlJykgewogICAgICAgICAgLy8g6L+b5YWl5piO57uG5LuOL3Byb2Nlc3MvZm9ybS9nZXRBdHRhY2htZW50SW5mb+aOpeWPo+WPluWIsOWAvOS6i+S7tgogICAgICAgICAgdGhpcy5maWxlTGlzdCA9IG5ld1ZhbHVlWydjb2RlJ107CiAgICAgICAgfQogICAgICB9LAogICAgICAvLyBpbW1lZGlhdGU6dHJ1ZSwKICAgICAgZGVlcDogdHJ1ZQogICAgfSwKICAgIC8vIGZpbGVDb2RlTGlzdOWAvOaUueWPmAogICAgdmFsdWU6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgICAvLyDlpoLmnpwvcHJvY2Vzcy9kb2N1bWVudERldGFpbOi/lOWbnuacieWAvO+8jOWImeiwg+eUqC9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6Pojrflj5blrozmlbTpmYTku7bkv6Hmga8KICAgICAgICBpZiAodGhpcy5kb2N1bWVudElkICYmIHRoaXMuZmlyc3RHZXRWYWx1ZSAmJiBuZXdWYWx1ZSkgewogICAgICAgICAgdGhpcy5maXJzdEdldFZhbHVlID0gZmFsc2U7IC8vIOWPkeWwhOS6i+S7tu+8jOiwg+eUqC9wcm9jZXNzL2Zvcm0vZ2V0QXR0YWNobWVudEluZm/mjqXlj6MKCiAgICAgICAgICB0aGlzLiRmb3JtRXZlbnRFbWl0KCdnZXRBdHRhY2htZW50JywgbmV3VmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8gY2hhbmdl5pa55rOVIOS4iuS8oOS4reOAgeWujOaIkOOAgeWksei0pemDveS8muiwg+eUqOi/meS4quWHveaVsAogICAgbG9hZFN1Y2Nlc3M6IGZ1bmN0aW9uIGxvYWRTdWNjZXNzKGV2ZW50KSB7CiAgICAgIHRoaXMuZmlsZUxpc3QgPSBldmVudC5maWxlTGlzdDsKICAgICAgdmFyIHJlcyA9IGV2ZW50LmZpbGUucmVzcG9uc2U7IC8vIOWmguaenOaciXJlc3BvbnNl77yM5YiZ5LiK5Lyg5a6M5oiQCgogICAgICBpZiAocmVzKSB7CiAgICAgICAgLy8g5re75Yqg5pON5L2cCiAgICAgICAgdmFyIGJ0dCA9IHt9OwogICAgICAgIGJ0dC51aWQgPSByZXMuZGF0YS5hdHRhY2htZW50Q29kZTsgLy8gYnR0Lm5hbWUgPSByZXMuZGF0YS5hdHRhY2htZW50TmFtZS5zbGljZShyZXMuZGF0YS5hdHRhY2htZW50Q29kZS5sZW5ndGgpOwoKICAgICAgICBidHQubmFtZSA9IHJlcy5kYXRhLmF0dGFjaG1lbnROYW1lOwogICAgICAgIGJ0dC51cmwgPSByZXMuZGF0YS5hdHRhY2htZW50VXJsOwogICAgICAgIHRoaXMuZmlsZUxpc3Quc3BsaWNlKHRoaXMuZmlsZUxpc3QubGVuZ3RoIC0gMSwgMSk7CiAgICAgICAgdGhpcy5maWxlTGlzdC5wdXNoKGJ0dCk7CiAgICAgICAgdGhpcy5maXJzdEdldFZhbHVlID0gZmFsc2U7CiAgICAgICAgdmFyIHZhbHVlU3RyaW5nID0gdGhpcy5maWxlTGlzdC5tYXAoZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICAgIHJldHVybiBhdHRyLnVpZDsKICAgICAgICB9KS50b1N0cmluZygpOwogICAgICAgIHRoaXMuJGZvcm1FdmVudEVtaXQoJ2NoYW5nZScsIHZhbHVlU3RyaW5nKTsKICAgICAgfQogICAgfQogIH0KfTs="},{"version":3,"sources":["dap-ui-upload-picture.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAqBA,OAAA,mBAAA,MAAA,0CAAA;AACA,OAAA,wBAAA,MAAA,+CAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,oBADA;AAEA,EAAA,IAAA,EAAA,iBAFA;AAGA,EAAA,MAAA,EAAA,CAAA,mBAAA,EAAA,wBAAA,CAHA;AAIA,EAAA,KAAA,EAAA,EAJA;AAMA,EAAA,IANA,kBAMA;AACA,WAAA;AACA,MAAA,QAAA,EAAA,EADA;AACA;AACA,MAAA,aAAA,EAAA,IAFA,CAEA;;AAFA,KAAA;AAIA,GAXA;AAYA,EAAA,KAAA,EAAA;AACA;AACA,IAAA,YAAA,EAAA;AACA,MAAA,OADA,mBACA,QADA,EACA,QADA,EACA;AACA,YAAA,QAAA,CAAA,MAAA,CAAA,KAAA,QAAA,EAAA;AACA;AACA,eAAA,QAAA,GAAA,KAAA,QAAA,CAAA,MAAA,CAAA,UAAA,IAAA;AAAA,mBAAA,IAAA,CAAA,GAAA,KAAA,QAAA,CAAA,MAAA,CAAA;AAAA,WAAA,CAAA;AACA,cAAA,WAAA,GAAA,KAAA,QAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,mBAAA,IAAA,CAAA,GAAA;AACA,WAFA,EAEA,QAFA,EAAA;AAGA,eAAA,cAAA,CAAA,QAAA,EAAA,WAAA;AACA,SAPA,MAOA,IAAA,QAAA,CAAA,MAAA,CAAA,KAAA,UAAA,EAAA;AACA;AACA,eAAA,QAAA,GAAA,QAAA,CAAA,MAAA,CAAA;AACA;AACA,OAbA;AAcA;AACA,MAAA,IAAA,EAAA;AAfA,KAFA;AAmBA;AACA,IAAA,KAAA,EAAA;AACA,MAAA,OADA,mBACA,QADA,EACA,QADA,EACA;AACA;AACA,YAAA,KAAA,UAAA,IAAA,KAAA,aAAA,IAAA,QAAA,EAAA;AACA,eAAA,aAAA,GAAA,KAAA,CADA,CAEA;;AACA,eAAA,cAAA,CAAA,eAAA,EAAA,QAAA;AACA;AACA;AARA;AApBA,GAZA;AA2CA,EAAA,OAAA,EAAA;AACA;AACA,IAAA,WAFA,uBAEA,KAFA,EAEA;AACA,WAAA,QAAA,GAAA,KAAA,CAAA,QAAA;AACA,UAAA,GAAA,GAAA,KAAA,CAAA,IAAA,CAAA,QAAA,CAFA,CAGA;;AACA,UAAA,GAAA,EAAA;AACA;AACA,YAAA,GAAA,GAAA,EAAA;AACA,QAAA,GAAA,CAAA,GAAA,GAAA,GAAA,CAAA,IAAA,CAAA,cAAA,CAHA,CAIA;;AACA,QAAA,GAAA,CAAA,IAAA,GAAA,GAAA,CAAA,IAAA,CAAA,cAAA;AACA,QAAA,GAAA,CAAA,GAAA,GAAA,GAAA,CAAA,IAAA,CAAA,aAAA;AACA,aAAA,QAAA,CAAA,MAAA,CAAA,KAAA,QAAA,CAAA,MAAA,GAAA,CAAA,EAAA,CAAA;AACA,aAAA,QAAA,CAAA,IAAA,CAAA,GAAA;AACA,aAAA,aAAA,GAAA,KAAA;AACA,YAAA,WAAA,GAAA,KAAA,QAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,iBAAA,IAAA,CAAA,GAAA;AACA,SAFA,EAEA,QAFA,EAAA;AAGA,aAAA,cAAA,CAAA,QAAA,EAAA,WAAA;AACA;AACA;AArBA;AA3CA,CAAA","sourcesContent":["<!--\n * @Author: lizhihang\n * @Date: 2020-02-06 10:37:47\n * @LastEditors: lizhihang\n * @LastEditTime: 2020-02-17 08:47:50\n * @Description: file content description\n -->\n<template>\n  <div class=\"dap-ui-upload-picture dap-ui-form-item\">\n    <a-upload\n      listType=\"picture\"\n      :fileList=\"fileList\"\n      :customRequest=\"customRequest\"\n      @change=\"loadSuccess($event)\"\n      :remove=\"remove\"\n    >\n      <a-button type=\"primary\"> <a-icon type=\"picture\" /> {{btnTitle}} </a-button>\n    </a-upload>\n  </div>\n</template>\n<script>\nimport BasicComponentMixin from '../../../mixins/basic-component-mixin.js';\nimport AttachmentComponentMixin from \"../../../mixins/attachment-component-mixin.js\";\n\nexport default {\n  name: \"DapUiUploadPicture\",\n  type: 'FORM_ATTACHMENT',\n  mixins: [BasicComponentMixin, AttachmentComponentMixin],\n  props: {\n  },\n  data() {\n    return {\n      fileList: [], // 文件列表，形式为[{uid:\"123\",name:\"1.jpg\",url:\"http://123388*****\"}]\n      firstGetValue: true, // 第一次获取到value判断 \n    }\n  },\n  watch: {\n    // fileCodeList值改变 为监听删除成功事件和进入明细从接口/process/form/getAttachmentInfo取到值事件\n    fileCodeList : {\n      handler (newValue, oldValue) {\n        if (newValue['type'] === 'delete') {\n          // 删除事件\n          this.fileList = this.fileList.filter(item => item.uid !== newValue['code']);\n          const valueString = this.fileList.map(attr => {\n            return attr.uid ;\n          }).toString();\n          this.$formEventEmit('change', valueString);\n        } else if (newValue['type'] === 'getValue') {\n          // 进入明细从/process/form/getAttachmentInfo接口取到值事件\n          this.fileList = newValue['code'];\n        }\n      },\n      // immediate:true,\n      deep: true\n    },\n    // fileCodeList值改变\n    value: {\n      handler (newValue, oldValue) {\n        // 如果/process/documentDetail返回有值，则调用/process/form/getAttachmentInfo接口获取完整附件信息\n        if (this.documentId && this.firstGetValue && newValue) {\n          this.firstGetValue = false;\n          // 发射事件，调用/process/form/getAttachmentInfo接口\n          this.$formEventEmit('getAttachment', newValue);\n        }\n      },\n    }\n  },\n  methods: {\n    // change方法 上传中、完成、失败都会调用这个函数\n    loadSuccess(event) {\n      this.fileList=event.fileList;\n      const res = event.file.response;\n      // 如果有response，则上传完成\n      if (res) {\n        // 添加操作\n        const btt = {};\n        btt.uid = res.data.attachmentCode ;\n        // btt.name = res.data.attachmentName.slice(res.data.attachmentCode.length);\n        btt.name = res.data.attachmentName;\n        btt.url = res.data.attachmentUrl ;\n        this.fileList.splice(this.fileList.length - 1, 1) ;\n        this.fileList.push(btt);\n        this.firstGetValue = false;\n        const valueString = this.fileList.map(attr => {\n          return attr.uid ;\n        }).toString();\n        this.$formEventEmit('change', valueString);\n      }\n    },\n    \n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style src=\"./index.less\" lang=\"less\">\n</style>\n"],"sourceRoot":"packages/components/form/upload-picture"}]}